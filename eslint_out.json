[{"filePath":"C:\\Users\\thoma\\Downloads\\PROJET DEV IA\\MINCRAFT\\minecraft-dashboard\\src\\components\\UserManagement.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\thoma\\Downloads\\PROJET DEV IA\\MINCRAFT\\minecraft-dashboard\\src\\components\\UserManagement.tsx:55:9\n  53 |\n  54 |     useEffect(() => {\n> 55 |         loadData();\n     |         ^^^^^^^^ Avoid calling setState() directly within an effect\n  56 |     }, [loadData]);\n  57 |\n  58 |     const handleGenerateCode = async () => {","line":55,"column":9,"nodeType":null,"endLine":55,"endColumn":17}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect, useCallback } from 'react';\r\nimport { generateInvitationCode, listInvitationCodes, revokeCode, listUsers, removeUser, promoteUser } from '@/actions/auth';\r\nimport { Ticket, Copy, XCircle, Trash2, UserPlus, Users, ShieldCheck } from 'lucide-react';\r\nimport styles from './UserManagement.module.scss';\r\n\r\ninterface InvitationCode {\r\n    code: string;\r\n    createdBy: string;\r\n    createdAt: string;\r\n    maxUses: number;\r\n    uses: number;\r\n    usedBy?: string[];\r\n    usedAt?: string[];\r\n    expiresAt?: string;\r\n    isActive: boolean;\r\n}\r\n\r\ninterface User {\r\n    id: string;\r\n    username: string;\r\n    createdAt: string;\r\n    role: 'admin' | 'user';\r\n}\r\n\r\nexport default function UserManagement() {\r\n    const [codes, setCodes] = useState<InvitationCode[]>([]);\r\n    const [users, setUsers] = useState<User[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [generating, setGenerating] = useState(false);\r\n    const [activeTab, setActiveTab] = useState<'codes' | 'users'>('codes');\r\n    const [expiryDays, setExpiryDays] = useState<number | undefined>(undefined);\r\n    const [maxUses, setMaxUses] = useState<number>(1);\r\n\r\n    const loadData = useCallback(async () => {\r\n        setLoading(true);\r\n        const [codesResult, usersResult] = await Promise.all([\r\n            listInvitationCodes(),\r\n            listUsers()\r\n        ]);\r\n\r\n        if (codesResult.success) {\r\n            setCodes(codesResult.codes);\r\n        }\r\n\r\n        if (usersResult.success) {\r\n            setUsers(usersResult.users);\r\n        }\r\n\r\n        setLoading(false);\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        loadData();\r\n    }, [loadData]);\r\n\r\n    const handleGenerateCode = async () => {\r\n        setGenerating(true);\r\n        const result = await generateInvitationCode(expiryDays, maxUses);\r\n        if (result.success) {\r\n            await loadData();\r\n            // Copy to clipboard\r\n            if (result.code) {\r\n                navigator.clipboard.writeText(result.code);\r\n                alert(`Code generated and copied to clipboard: ${result.code}`);\r\n            }\r\n        } else {\r\n            alert(`Error: ${result.error}`);\r\n        }\r\n        setGenerating(false);\r\n    };\r\n\r\n    const handleRevokeCode = async (code: string) => {\r\n        if (!confirm('Are you sure you want to revoke this code?')) return;\r\n\r\n        const result = await revokeCode(code);\r\n        if (result.success) {\r\n            await loadData();\r\n        } else {\r\n            alert(`Error: ${result.error}`);\r\n        }\r\n    };\r\n\r\n    const handleDeleteUser = async (userId: string, username: string) => {\r\n        if (!confirm(`Are you sure you want to delete user \"${username}\"?`)) return;\r\n\r\n        const result = await removeUser(userId);\r\n        if (result.success) {\r\n            await loadData();\r\n        } else {\r\n            alert(`Error: ${result.error}`);\r\n        }\r\n    };\r\n\r\n    const handlePromoteUser = async (userId: string, username: string, currentRole: 'admin' | 'user') => {\r\n        const newRole = currentRole === 'admin' ? 'user' : 'admin';\r\n        const actionName = newRole === 'admin' ? 'promote to Admin' : 'demote to User';\r\n\r\n        if (!confirm(`Are you sure you want to ${actionName} \"${username}\"?`)) return;\r\n\r\n        const result = await promoteUser(userId, newRole);\r\n        if (result.success) {\r\n            await loadData();\r\n        } else {\r\n            alert(`Error: ${result.error}`);\r\n        }\r\n    };\r\n\r\n    const copyToClipboard = (text: string) => {\r\n        navigator.clipboard.writeText(text);\r\n        alert('Code copied to clipboard!');\r\n    };\r\n\r\n    const formatDate = (dateString: string) => {\r\n        return new Date(dateString).toLocaleString();\r\n    };\r\n\r\n    if (loading) {\r\n        return <div className={styles.loading}>Loading...</div>;\r\n    }\r\n\r\n    return (\r\n        <div className={styles.container}>\r\n            <div className={styles.header}>\r\n                <h2>User Management</h2>\r\n                <p>Manage invitation codes and user accounts</p>\r\n            </div>\r\n\r\n            <div className={styles.tabs}>\r\n                <button\r\n                    className={`${styles.tab} ${activeTab === 'codes' ? styles.active : ''}`}\r\n                    onClick={() => setActiveTab('codes')}\r\n                >\r\n                    <Ticket size={18} />\r\n                    Invitation Codes\r\n                </button>\r\n                <button\r\n                    className={`${styles.tab} ${activeTab === 'users' ? styles.active : ''}`}\r\n                    onClick={() => setActiveTab('users')}\r\n                >\r\n                    <Users size={18} />\r\n                    Users\r\n                </button>\r\n            </div>\r\n\r\n            {activeTab === 'codes' && (\r\n                <div className={styles.section}>\r\n                    <div className={styles.generateSection}>\r\n                        <h3>Generate New Code</h3>\r\n                        <div className={styles.generateForm}>\r\n                            <div className={styles.inputGroup}>\r\n                                <label>Expiry (days, optional)</label>\r\n                                <input\r\n                                    type=\"number\"\r\n                                    placeholder=\"No expiry\"\r\n                                    value={expiryDays || ''}\r\n                                    onChange={(e) => setExpiryDays(e.target.value ? parseInt(e.target.value) : undefined)}\r\n                                    className={styles.input}\r\n                                />\r\n                            </div>\r\n                            <div className={styles.inputGroup}>\r\n                                <label>Uses (max)</label>\r\n                                <input\r\n                                    type=\"number\"\r\n                                    min=\"1\"\r\n                                    placeholder=\"Max uses\"\r\n                                    value={maxUses}\r\n                                    onChange={(e) => setMaxUses(parseInt(e.target.value) || 1)}\r\n                                    className={styles.input}\r\n                                />\r\n                            </div>\r\n                            <button\r\n                                onClick={handleGenerateCode}\r\n                                disabled={generating}\r\n                                className={styles.generateBtn}\r\n                            >\r\n                                <UserPlus size={18} />\r\n                                {generating ? 'Generating...' : 'Generate Code'}\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className={styles.codesList}>\r\n                        <h3>Invitation Codes ({codes.length})</h3>\r\n                        {codes.length === 0 ? (\r\n                            <p className={styles.empty}>No invitation codes yet. Generate one above.</p>\r\n                        ) : (\r\n                            <div className={styles.table}>\r\n                                {codes.map((code) => (\r\n                                    <div key={code.code} className={`${styles.codeItem} ${!code.isActive ? styles.inactive : ''}`}>\r\n                                        <div className={styles.codeInfo}>\r\n                                            <div className={styles.codeValue}>\r\n                                                <Ticket size={16} />\r\n                                                <code>{code.code}</code>\r\n                                                <button\r\n                                                    onClick={() => copyToClipboard(code.code)}\r\n                                                    className={styles.copyBtn}\r\n                                                    title=\"Copy to clipboard\"\r\n                                                >\r\n                                                    <Copy size={14} />\r\n                                                </button>\r\n                                            </div>\r\n                                            <div className={styles.codeDetails}>\r\n                                                <span>Created by: {code.createdBy}</span>\r\n                                                <span>Created: {formatDate(code.createdAt)}</span>\r\n                                                {code.expiresAt && (\r\n                                                    <span>Expires: {formatDate(code.expiresAt)}</span>\r\n                                                )}\r\n                                                <span>Uses: {code.uses} / {code.maxUses}</span>\r\n                                                {code.usedBy && code.usedBy.length > 0 && (\r\n                                                    <span className={styles.usedByList}>\r\n                                                        Used by: {code.usedBy.join(', ')}\r\n                                                    </span>\r\n                                                )}\r\n                                            </div>\r\n                                        </div>\r\n                                        <div className={styles.codeActions}>\r\n                                            <span className={`${styles.status} ${code.isActive ? styles.active : styles.revoked}`}>\r\n                                                {code.uses >= code.maxUses ? 'Used Up' : code.isActive ? 'Active' : 'Revoked'}\r\n                                            </span>\r\n                                            {code.isActive && code.uses < code.maxUses && (\r\n                                                <button\r\n                                                    onClick={() => handleRevokeCode(code.code)}\r\n                                                    className={styles.revokeBtn}\r\n                                                    title=\"Revoke code\"\r\n                                                >\r\n                                                    <XCircle size={16} />\r\n                                                </button>\r\n                                            )}\r\n                                        </div>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {activeTab === 'users' && (\r\n                <div className={styles.section}>\r\n                    <div className={styles.usersList}>\r\n                        <h3>Registered Users ({users.length})</h3>\r\n                        {users.length === 0 ? (\r\n                            <p className={styles.empty}>No users registered yet.</p>\r\n                        ) : (\r\n                            <div className={styles.table}>\r\n                                {users.map((user) => (\r\n                                    <div key={user.id} className={styles.userItem}>\r\n                                        <div className={styles.userInfo}>\r\n                                            <div className={styles.userName}>\r\n                                                <Users size={16} />\r\n                                                <strong>{user.username}</strong>\r\n                                                <span className={`${styles.role} ${styles[user.role]}`}>\r\n                                                    {user.role}\r\n                                                </span>\r\n                                            </div>\r\n                                            <div className={styles.userDetails}>\r\n                                                <span>ID: {user.id}</span>\r\n                                                <span>Joined: {formatDate(user.createdAt)}</span>\r\n                                            </div>\r\n                                        </div>\r\n                                        <div className={styles.userActions}>\r\n                                            <button\r\n                                                onClick={() => handlePromoteUser(user.id, user.username, user.role)}\r\n                                                className={user.role === 'admin' ? styles.demoteBtn : styles.promoteBtn}\r\n                                                title={user.role === 'admin' ? \"Demote to User\" : \"Make Admin\"}\r\n                                            >\r\n                                                <ShieldCheck size={16} />\r\n                                            </button>\r\n                                            {user.role !== 'admin' && (\r\n                                                <button\r\n                                                    onClick={() => handleDeleteUser(user.id, user.username)}\r\n                                                    className={styles.deleteBtn}\r\n                                                    title=\"Delete user\"\r\n                                                >\r\n                                                    <Trash2 size={16} />\r\n                                                </button>\r\n                                            )}\r\n                                        </div>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]}]
